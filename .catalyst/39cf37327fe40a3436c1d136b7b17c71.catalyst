{"title":{"en":"H2. Maximum Crossings (Hard Version)","ru":"H2. Максимизация пересечений (сложная версия)"},"contestId":"1676","problemIndex":"H2","timeLimit":{"en":"1 second","ru":"1 секунда"},"memLimit":{"en":"256 megabytes","ru":"256 мегабайт"},"inputFormat":{"en":"standard input","ru":"стандартный ввод"},"outputFormat":{"en":"standard output","ru":"стандартный вывод"},"problemHtml":{"en":"<p><span class=\"tex-font-style-it\">The only difference between the two versions is that in this version</span> $$$n \\leq 2 \\cdot 10^5$$$ and the sum of $$$n$$$ over all test cases does not exceed $$$2 \\cdot 10^5$$$<span class=\"tex-font-style-it\">.</span></p><p>A <span class=\"tex-font-style-it\">terminal</span> is a row of $$$n$$$ equal segments numbered $$$1$$$ to $$$n$$$ in order. There are two terminals, one above the other. </p><p>You are given an array $$$a$$$ of length $$$n$$$. For all $$$i = 1, 2, \\dots, n$$$, there should be a straight wire from some point on segment $$$i$$$ of the top terminal to some point on segment $$$a_i$$$ of the bottom terminal. You can't select the endpoints of a segment. For example, the following pictures show two possible wirings if $$$n=7$$$ and $$$a=[4,1,4,6,7,7,5]$$$.</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/660719c81039b1ce9c48c6c80d2c922157422c16.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"> </center><p>A <span class=\"tex-font-style-it\">crossing</span> occurs when two wires share a point in common. In the picture above, crossings are circled in red.</p><p>What is the <span class=\"tex-font-style-bf\">maximum</span> number of crossings there can be if you place the wires optimally?</p>","ru":"<p><span class=\"tex-font-style-it\">Единственная разница между двумя версиями состоит в том, что в этой версии</span> $$$n \\leq 2 \\cdot 10^5$$$ и сумма по $$$n$$$ по всем наборам входных данных теста не превосходит $$$2 \\cdot 10^5$$$<span class=\"tex-font-style-it\">.</span></p><p><span class=\"tex-font-style-it\">Терминал</span>&nbsp;— это ряд из $$$n$$$ равных отрезков, пронумерованных от $$$1$$$ до $$$n$$$ по порядку. Есть два <span class=\"tex-font-style-it\">терминала</span>, один над другим.</p><p>Вам дан массив $$$a$$$ длины $$$n$$$. Для всех $$$i = 1, 2, \\dots, n$$$ должен быть прямой провод из некоторой точки на отрезке $$$i$$$ верхнего <span class=\"tex-font-style-it\">терминала</span> в некоторую точку на отрезке $$$a_i$$$ нижнего <span class=\"tex-font-style-it\">терминала</span>. Например, на следующих рисунках показаны два возможных соединения, при $$$n=7$$$ и $$$a=[4,1,4,6,7,7,5]$$$.</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/660719c81039b1ce9c48c6c80d2c922157422c16.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"> </center><p><span class=\"tex-font-style-it\">Пересечение</span> происходит, когда два провода имеют общую точку. На картинке выше пересечения обведены красным.</p><p>Какое <span class=\"tex-font-style-bf\">максимальное</span> количество пересечений может быть при оптимальном размещении проводов?</p>"},"inSpecsHtml":{"en":"<div class=\"section-title\">Input</div><p>The first line contains an integer $$$t$$$ ($$$1 \\leq t \\leq 1000$$$)&nbsp;— the number of test cases.</p><p>The first line of each test case contains an integer $$$n$$$ ($$$1 \\leq n \\leq 2 \\cdot 10^5$$$)&nbsp;— the length of the array.</p><p>The second line of each test case contains $$$n$$$ integers $$$a_1, a_2, \\dots, a_n$$$ ($$$1 \\leq a_i \\leq n$$$)&nbsp;— the elements of the array.</p><p>The sum of $$$n$$$ across all test cases does not exceed $$$2 \\cdot 10^5$$$.</p>","ru":"<div class=\"section-title\">Входные данные</div><p>Первая строка содержит целое число $$$t$$$ ($$$1 \\leq t \\leq 1000$$$)&nbsp;— количество наборов входных данных.</p><p>Первая строка каждого набора содержит целое число $$$n$$$ ($$$1 \\leq n \\leq 2 \\cdot 10^5$$$)&nbsp;— длина массива.</p><p>Вторая строка каждого набора содержит $$$n$$$ целых чисел $$$a_1, a_2, \\dots, a_n$$$ ($$$1 \\leq a_i \\leq n$$$)&nbsp;— элементы массива.</p><p>Сумма $$$n$$$ по всем наборам входных данных не превосходит $$$2 \\cdot 10^5$$$.</p>"},"outSpecsHtml":{"en":"<div class=\"section-title\">Output</div><p>For each test case, output a single integer&nbsp;— the <span class=\"tex-font-style-bf\">maximum</span> number of crossings there can be if you place the wires optimally.</p>","ru":"<div class=\"section-title\">Выходные данные</div><p>Для каждого набора выведите единственное целое число&nbsp;— <span class=\"tex-font-style-bf\">максимальное</span> количество пересечений, при оптимальном расположении проводов.</p>"},"noteHtml":{"en":"<div class=\"section-title\">Note</div><p>The first test case is shown in the second picture in the statement.</p><p>In the second test case, the only wiring possible has the two wires cross, so the answer is $$$1$$$.</p><p>In the third test case, the only wiring possible has one wire, so the answer is $$$0$$$.</p>","ru":"<div class=\"section-title\">Примечание</div><p>Первый пример показан на втором рисунке в условии.</p><p>Во втором примере при единственно возможном соединении появляется пересечение двух проводов, поэтому ответ равен $$$1$$$.</p><p>В третьем тестовом примере единственно возможное соединение состоит из одного провода, поэтому ответ равен $$$0$$$.</p>"},"sampleTestcases":[{"id":1652597510360,"input":"4\n7\n4 1 4 6 7 7 5\n2\n2 1\n1\n1\n3\n2 2 2\n","output":"6\n1\n0\n3\n"}],"submitUrl":"https://codeforces.com/contest/1676/submit","language":"c++","isPartOfContest":true}